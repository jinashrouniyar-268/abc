<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Flowcut Assistant</title>
    <link rel="stylesheet" href="chat.css">
    <script type="text/javascript" src="qrc:/qtwebchannel/qwebchannel.js"></script>
</head>
<body>
    <div class="chat-container" data-theme="bloomberg-light" role="application" aria-label="Flowcut Assistant chat">
        <div class="chat-preamble">
            <div id="chat-preamble-label" class="chat-preamble-label"></div>
            <div id="chat-preamble-status" class="chat-preamble-status"></div>
        </div>
        <!-- Tab bar for multi-chat sessions -->
        <div id="chat-tab-bar" class="chat-tab-bar" role="tablist" aria-label="Chat sessions">
            <!-- Tabs rendered dynamically by setTabs() -->
            <button type="button" id="chat-tab-add" class="chat-tab-add" title="New chat" aria-label="New chat">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M6 1v10M1 6h10" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
            </button>
        </div>
        <div id="chat-messages" class="chat-messages" role="log" aria-live="polite">
        </div>
        <div class="chat-input-row" id="chat-input-row">
            <div class="chat-input-glow-wrap" id="chat-input-glow-wrap">
                <div class="chat-input-glow-border"></div>
                <div class="chat-input-glow-inner">
                    <div class="chat-input-wrapper">
                        <div id="chat-input-overlay" class="chat-input-overlay" aria-hidden="true">
                            <span id="chat-typing-text"></span><span class="chat-typing-cursor">|</span>
                        </div>
                        <textarea
                            id="chat-input"
                            class="chat-input"
                            placeholder=" "
                            rows="3"
                            aria-label="Message input"
                        ></textarea>
                    </div>
                    <div class="chat-bottom-bar">
                        <div class="chat-bottom-left">
                            <select id="chat-model-select" style="display:none;" aria-hidden="true"></select>
                            <button type="button" id="chat-model-trigger" class="chat-model-trigger" aria-label="Select model" aria-haspopup="listbox">
                                <svg class="chat-model-icon" width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M8 1a3 3 0 00-3 3v1H4a2 2 0 00-2 2v6a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-1V4a3 3 0 00-3-3zm0 1.5A1.5 1.5 0 019.5 4v1h-3V4A1.5 1.5 0 018 2.5zM6 9a1 1 0 112 0 1 1 0 01-2 0zm4 0a1 1 0 112 0 1 1 0 01-2 0z" fill="currentColor"/></svg>
                                <span id="chat-model-label">Model</span>
                                <svg class="chat-model-chevron" width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M2.5 6.5L5 4l2.5 2.5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            </button>
                            <div id="chat-model-menu" class="chat-model-menu" role="listbox" aria-label="AI model" style="display:none;"></div>
                            <!-- Context progress ring -->
                            <div id="chat-context-ring-wrap" class="chat-context-ring-wrap">
                                <svg id="chat-context-ring" class="chat-context-ring" width="20" height="20" viewBox="0 0 20 20">
                                    <circle class="chat-context-ring-bg" cx="10" cy="10" r="8" fill="none" stroke-width="2.5"/>
                                    <circle id="chat-context-ring-fg" class="chat-context-ring-fg" cx="10" cy="10" r="8" fill="none" stroke-width="2.5"
                                        stroke-dasharray="50.265" stroke-dashoffset="50.265"
                                        transform="rotate(-90 10 10)"/>
                                </svg>
                                <div id="chat-context-popover" class="chat-context-popover">
                                    <div class="chat-context-popover-row">
                                        <span class="chat-context-popover-label">Context</span>
                                        <span id="chat-context-popover-pct" class="chat-context-popover-value font-mono">0%</span>
                                    </div>
                                    <div class="chat-context-popover-bar-track">
                                        <div id="chat-context-popover-bar-fill" class="chat-context-popover-bar-fill"></div>
                                    </div>
                                    <div class="chat-context-popover-row chat-context-popover-detail">
                                        <span id="chat-context-popover-tokens" class="font-mono">0 / 0</span>
                                        <span>tokens</span>
                                    </div>
                                </div>
                            </div>
                            <!-- Carry-forward button (shown when context >= 85%) -->
                            <button type="button" id="chat-carry-forward-btn" class="chat-bottom-icon chat-carry-forward-btn" title="Carry forward conversation" aria-label="Carry forward" style="display:none;">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M3 8h10M10 4l4 4-4 4" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            </button>
                            <button type="button" id="chat-clear-btn" class="chat-bottom-icon" title="Clear chat" aria-label="Clear chat">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2 4h12M5.333 4V2.667a1.333 1.333 0 011.334-1.334h2.666a1.333 1.333 0 011.334 1.334V4m2 0v9.333a1.333 1.333 0 01-1.334 1.334H4.667a1.333 1.333 0 01-1.334-1.334V4h9.334z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            </button>
                        </div>
                        <div class="chat-bottom-right">
                            <button type="button" id="chat-cancel-btn" class="chat-bottom-icon chat-cancel-icon" title="Cancel" aria-label="Cancel request" style="display:none;">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="3" y="3" width="10" height="10" rx="2" stroke="currentColor" stroke-width="1.2"/></svg>
                            </button>
                            <button type="button" id="chat-send-btn" class="chat-send-circle" title="Send (Enter)" aria-label="Send message">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 12V4m0 0L4.5 7.5M8 4l3.5 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="chat.js"></script>
</body>
</html>
